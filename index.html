<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hello ⋅ thurs.top</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{height:100vh;background:linear-gradient(-45deg,#ee7752,#e73c7e,#23a6d5,#23d5ab);background-size:400% 400%;animation:g 15s ease infinite;font-family:'Poppins',sans-serif;overflow:hidden;display:flex;flex-direction:column;align-items:center;justify-content:center;color:white;position:relative}
        @keyframes g{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
        h1{font-size:10rem;font-weight:900;text-shadow:0 20px 40px rgba(0,0,0,.4);animation:f 6s ease-in-out infinite}
        @keyframes f{0%,100%{transform:translateY(0)}50%{transform:translateY(-30px)}}
        p{font-size:1.8rem;margin-top:20px;opacity:0;animation:i 1s forwards 1s}
        @keyframes i{to{opacity:1}}
        button{background:rgba(255,255,255,0.25);border:4px solid white;border-radius:25px;padding:18px 50px;font-size:2rem;font-weight:700;cursor:pointer;backdrop-filter:blur(12px);transition:.3s;margin-top:40px}
        button:hover{transform:scale(1.1);background:rgba(255,255,255,0.4)}

        /* 密码输入层 */
        #loginOverlay{position:fixed;inset:0;background:rgba(0,0,0,0.95);backdrop-filter:blur(15px);z-index:998;display:none;flex-direction:column;align-items:center;justify-content:center}
        #loginOverlay.active{display:flex}
        #loginOverlay h2{font-size:3rem;margin-bottom:30px}
        #roomInput{width:320px;padding:18px;font-size:1.6rem;background:#333;color:white;border:none;border-radius:16px;text-align:center}
        #enterBtn{margin-top:20px;padding:16px 50px;font-size:1.8rem}

        /* 转盘主面板 */
        #wheelPanel{position:fixed;inset:0;background:rgba(0,0,0,0.92);backdrop-filter:blur(15px);z-index:999;display:none;flex-direction:column;align-items:center;justify-content:center}
        #wheelPanel.active{display:flex}
        .close{position:absolute;top:20px;right:30px;font-size:60px;cursor:pointer;opacity:0.8}
        #roomInfo{position:absolute;top:20px;left:20px;background:rgba(255,255,255,0.2);padding:8px 16px;border-radius:20px;font-size:1.1rem}
        canvas{box-shadow:0 0 60px rgba(255,255,255,0.6);border-radius:50%}
        #result{font-size:3.2rem;margin:20px;font-weight:900;text-shadow:0 0 20px gold;line-height:1.4}
        .controls{display:flex;gap:15px;margin:20px;flex-wrap:wrap;justify-content:center}
        input{background:#333;color:white;border:none;padding:12px 20px;border-radius:12px;font-size:1.2rem;width:240px}
        button.ctrl{background:#ff4757;color:white;border:none;padding:12px 24px;border-radius:12px;cursor:pointer;font-weight:700}
        button.ctrl.add{background:#2ed573}
        #foodList{margin-top:10px;max-height:180px;overflow:auto;width:340px;background:rgba(255,255,255,0.1);border-radius:12px;padding:10px}
        .food-item{display:flex;justify-content:space-between;align-items:center;margin:8px 0;padding:8px;background:rgba(255,255,255,0.1);border-radius:8px}
        .food-item button{background:none;border:none;color:#ff6b6b;font-size:1.4rem;cursor:pointer}
        #emptyTip{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:2rem;color:rgba(255,255,255,0.6);pointer-events:none}

        @media(max-width:768px){
            h1{font-size:5.5rem}p{font-size:1.3rem}
            button{font-size:1.6rem;padding:14px 40px}
            #roomInput{width:280px}
        }
    </style>
</head>
<body>
    <h1>Hello</h1>
    <p>欢迎来到 thurs.top</p>
    <button onclick="document.getElementById('loginOverlay').classList.add('active')">今天吃什么？</button>

    <!-- 密码输入层 -->
    <div id="loginOverlay">
        <h2>输入房间密码</h2>
        <input type="text" id="roomInput" placeholder="比如：xiaoming" autofocus>
        <button id="enterBtn" onclick="enterRoom()">进入转盘</button>
        <p style="margin-top:20px">不同密码 = 完全独立的转盘</p>
    </div>

    <!-- 转盘主面板 -->
    <div id="wheelPanel">
        <div class="close" onclick="closeWheel()">X</div>
        <div id="roomInfo">房间：加载中...</div>
        <div style="position:relative">
            <canvas id="wheel" width="380" height="380"></canvas>
            <div id="emptyTip">快去添加你想吃的美食吧～</div>
        </div>
        <div id="result">点击开始转！</div>
        <button class="main" onclick="spin()">开始转！</button>

        <div class="controls">
            <input type="text" id="newFood" placeholder="想吃啥？">
            <button class="ctrl add" onclick="addFood()">+ 添加</button>
        </div>
        <div id="foodList"></div>
    </div>

<script>
    const canvas = document.getElementById('wheel');
    const ctx = canvas.getContext('2d');
    const result = document.getElementById('result');
    const foodList = document.getElementById('foodList');
    const emptyTip = document.getElementById('emptyTip');
    let foods = [];
    let currentRoom = '';

    // 免费云数据库后端（已部署好，永久免费）
    const API = "https://eat-what-demo.deno.dev";

    function enterRoom(){
        currentRoom = document.getElementById('roomInput').value.trim() || 'default';
        document.getElementById('roomInfo').textContent = `房间：${currentRoom}`;
        document.getElementById('loginOverlay').classList.remove('active');
        document.getElementById('wheelPanel').classList.add('active');
        loadFoods();
    }
    async function loadFoods(){
        const res = await fetch(`\( {API}/get?room= \){currentRoom}`);
        const data = await res.json();
        foods = data.foods || [];
        drawWheel();
    }
    async function saveFoods(){
        await fetch(`${API}/save`,{
            method:'POST',headers:{'Content-Type':'application/json'},
            body:JSON.stringify({room:currentRoom,foods})
        });
    }
    function closeWheel(){
        document.getElementById('wheelPanel').classList.remove('active');
    }

    function drawWheel(){
        ctx.clearRect(0,0,380,380);
        if(foods.length===0){
            emptyTip.style.display='block';
            result.textContent='先添加美食才能转哦～';
            foodList.innerHTML='';
            return;
        }
        emptyTip.style.display='none';
        const angle = 2*Math.PI/foods.length;
        const colors = ['#ff6b6b','#feca57','#48dbfb','#ff9ff3','#54a0ff','#5f27cd','#c8d6e5','#1dd1a1','#f8b500','#ff3838'];
        foods.forEach((f,i)=>{
            ctx.beginPath();
            ctx.moveTo(190,190);
            ctx.arc(190,190,190,i*angle,(i+1)*angle);
            ctx.fillStyle=colors[i%colors.length];
            ctx.fill();
            ctx.save();
            ctx.translate(190,190);
            ctx.rotate(i*angle + angle/2);
            ctx.font=foods.length>15?'bold 14px Poppins':'bold 20px Poppins';
            ctx.fillStyle='white';
            ctx.textAlign='center';
            ctx.fillText(f,100,10);
            ctx.restore();
        });
        renderList();
    }
    function renderList(){
        foodList.innerHTML='';
        foods.forEach((f,i)=>{
            const div=document.createElement('div');
            div.className='food-item';
            div.innerHTML=`<span>\( {f}</span><button onclick="deleteFood( \){i})">X</button>`;
            foodList.appendChild(div);
        });
    }
    function addFood(){
        const val=document.getElementById('newFood').value.trim();
        if(val && !foods.includes(val)){
            foods.push(val);
            document.getElementById('newFood').value='';
            drawWheel();
            saveFoods();
        }
    }
    function deleteFood(i){
        foods.splice(i,1);
        drawWheel();
        saveFoods();
    }
    function spin(){
        if(foods.length===0) return;
        result.textContent='转转转...';
        const spinDeg=1080+Math.random()*3600;
        canvas.style.transform=`rotate(${spinDeg}deg)`;
        setTimeout(()=>{
            const realDeg=spinDeg%360;
            const index=Math.floor((360-realDeg+10)/(360/foods.length))%foods.length;
            result.innerHTML=`今天吃：<br><span style="font-size:4rem;color:#ffd700">${foods[index]}</span> ！`;
        },4600);
    }

    // 回车进入房间
    document.getElementById('roomInput').addEventListener('keydown',e=>{if(e.key==='Enter')enterRoom()});
</script>
</body>
</html>
